{"ast":null,"code":"const spawn = require('child_process').spawn;\n\nmodule.exports = {\n  tree,\n  pidsForTree,\n  getStat\n};\n\nfunction getStat() {\n  return new Promise(resolve => {\n    const command = `ls /proc | grep -E '^[0-9]+$' | xargs -I{} cat /proc/{}/stat`;\n    const spawned = spawn('sh', ['-c', command], {\n      stdio: ['pipe', 'pipe', 'pipe']\n    });\n    var res = '';\n    spawned.stdout.on('data', data => res += data);\n    spawned.on('close', () => resolve(res));\n  });\n}\n\nfunction template(s) {\n  var stat = null; // 'pid', 'comm', 'state', 'ppid', 'pgrp'\n  // %d     (%s)    %c       %d      %d\n\n  s.replace(/(\\d+) \\((.*?)\\)\\s(.+?)\\s(\\d+)\\s/g, (all, PID, COMMAND, STAT, PPID) => {\n    stat = {\n      PID,\n      COMMAND,\n      PPID,\n      STAT\n    };\n  });\n  return stat;\n}\n\nfunction tree(stats) {\n  const processes = stats.split('\\n').map(template).filter(Boolean);\n  return processes;\n}\n\nfunction pidsForTree(tree, pid) {\n  if (typeof pid === 'number') {\n    pid = pid.toString();\n  }\n\n  const parents = [pid];\n  const pids = [];\n  tree.forEach(proc => {\n    if (parents.indexOf(proc.PPID) !== -1) {\n      parents.push(proc.PID);\n      pids.push(proc);\n    }\n  });\n  return pids;\n}","map":{"version":3,"sources":["/Users/jordanthomson/code/blog-with-Node-React/node_modules/pstree.remy/lib/utils.js"],"names":["spawn","require","module","exports","tree","pidsForTree","getStat","Promise","resolve","command","spawned","stdio","res","stdout","on","data","template","s","stat","replace","all","PID","COMMAND","STAT","PPID","stats","processes","split","map","filter","Boolean","pid","toString","parents","pids","forEach","proc","indexOf","push"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,eAAD,CAAP,CAAyBD,KAAvC;;AAEAE,MAAM,CAACC,OAAP,GAAiB;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,WAAR;AAAqBC,EAAAA;AAArB,CAAjB;;AAEA,SAASA,OAAT,GAAmB;AACjB,SAAO,IAAIC,OAAJ,CAAaC,OAAD,IAAa;AAC9B,UAAMC,OAAO,GAAI,8DAAjB;AACA,UAAMC,OAAO,GAAGV,KAAK,CAAC,IAAD,EAAO,CAAC,IAAD,EAAOS,OAAP,CAAP,EAAwB;AAC3CE,MAAAA,KAAK,EAAE,CAAC,MAAD,EAAS,MAAT,EAAiB,MAAjB;AADoC,KAAxB,CAArB;AAIA,QAAIC,GAAG,GAAG,EAAV;AACAF,IAAAA,OAAO,CAACG,MAAR,CAAeC,EAAf,CAAkB,MAAlB,EAA2BC,IAAD,IAAWH,GAAG,IAAIG,IAA5C;AACAL,IAAAA,OAAO,CAACI,EAAR,CAAW,OAAX,EAAoB,MAAMN,OAAO,CAACI,GAAD,CAAjC;AACD,GATM,CAAP;AAUD;;AAED,SAASI,QAAT,CAAkBC,CAAlB,EAAqB;AACnB,MAAIC,IAAI,GAAG,IAAX,CADmB,CAEnB;AACA;;AACAD,EAAAA,CAAC,CAACE,OAAF,CACE,kCADF,EAEE,CAACC,GAAD,EAAMC,GAAN,EAAWC,OAAX,EAAoBC,IAApB,EAA0BC,IAA1B,KAAmC;AACjCN,IAAAA,IAAI,GAAG;AAAEG,MAAAA,GAAF;AAAOC,MAAAA,OAAP;AAAgBE,MAAAA,IAAhB;AAAsBD,MAAAA;AAAtB,KAAP;AACD,GAJH;AAOA,SAAOL,IAAP;AACD;;AAED,SAASd,IAAT,CAAcqB,KAAd,EAAqB;AACnB,QAAMC,SAAS,GAAGD,KAAK,CAACE,KAAN,CAAY,IAAZ,EAAkBC,GAAlB,CAAsBZ,QAAtB,EAAgCa,MAAhC,CAAuCC,OAAvC,CAAlB;AAEA,SAAOJ,SAAP;AACD;;AAED,SAASrB,WAAT,CAAqBD,IAArB,EAA2B2B,GAA3B,EAAgC;AAC9B,MAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AAC3BA,IAAAA,GAAG,GAAGA,GAAG,CAACC,QAAJ,EAAN;AACD;;AACD,QAAMC,OAAO,GAAG,CAACF,GAAD,CAAhB;AACA,QAAMG,IAAI,GAAG,EAAb;AAEA9B,EAAAA,IAAI,CAAC+B,OAAL,CAAcC,IAAD,IAAU;AACrB,QAAIH,OAAO,CAACI,OAAR,CAAgBD,IAAI,CAACZ,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrCS,MAAAA,OAAO,CAACK,IAAR,CAAaF,IAAI,CAACf,GAAlB;AACAa,MAAAA,IAAI,CAACI,IAAL,CAAUF,IAAV;AACD;AACF,GALD;AAOA,SAAOF,IAAP;AACD","sourcesContent":["const spawn = require('child_process').spawn;\n\nmodule.exports = { tree, pidsForTree, getStat };\n\nfunction getStat() {\n  return new Promise((resolve) => {\n    const command = `ls /proc | grep -E '^[0-9]+$' | xargs -I{} cat /proc/{}/stat`;\n    const spawned = spawn('sh', ['-c', command], {\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    var res = '';\n    spawned.stdout.on('data', (data) => (res += data));\n    spawned.on('close', () => resolve(res));\n  });\n}\n\nfunction template(s) {\n  var stat = null;\n  // 'pid', 'comm', 'state', 'ppid', 'pgrp'\n  // %d     (%s)    %c       %d      %d\n  s.replace(\n    /(\\d+) \\((.*?)\\)\\s(.+?)\\s(\\d+)\\s/g,\n    (all, PID, COMMAND, STAT, PPID) => {\n      stat = { PID, COMMAND, PPID, STAT };\n    }\n  );\n\n  return stat;\n}\n\nfunction tree(stats) {\n  const processes = stats.split('\\n').map(template).filter(Boolean);\n\n  return processes;\n}\n\nfunction pidsForTree(tree, pid) {\n  if (typeof pid === 'number') {\n    pid = pid.toString();\n  }\n  const parents = [pid];\n  const pids = [];\n\n  tree.forEach((proc) => {\n    if (parents.indexOf(proc.PPID) !== -1) {\n      parents.push(proc.PID);\n      pids.push(proc);\n    }\n  });\n\n  return pids;\n}\n"]},"metadata":{},"sourceType":"script"}