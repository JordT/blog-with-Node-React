{"ast":null,"code":"var debug = require('debug')('nodemon');\n\nvar path = require('path');\n\nvar monitor = require('./monitor');\n\nvar cli = require('./cli');\n\nvar version = require('./version');\n\nvar util = require('util');\n\nvar utils = require('./utils');\n\nvar bus = utils.bus;\n\nvar help = require('./help');\n\nvar config = require('./config');\n\nvar spawn = require('./spawn');\n\nconst defaults = require('./config/defaults');\n\nvar eventHandlers = {}; // this is fairly dirty, but theoretically sound since it's part of the\n// stable module API\n\nconfig.required = utils.isRequired;\n\nfunction nodemon(settings) {\n  bus.emit('boot');\n  nodemon.reset(); // allow the cli string as the argument to nodemon, and allow for\n  // `node nodemon -V app.js` or just `-V app.js`\n\n  if (typeof settings === 'string') {\n    settings = settings.trim();\n\n    if (settings.indexOf('node') !== 0) {\n      if (settings.indexOf('nodemon') !== 0) {\n        settings = 'nodemon ' + settings;\n      }\n\n      settings = 'node ' + settings;\n    }\n\n    settings = cli.parse(settings);\n  } // set the debug flag as early as possible to get all the detailed logging\n\n\n  if (settings.verbose) {\n    utils.debug = true;\n  }\n\n  if (settings.help) {\n    if (process.stdout.isTTY) {\n      process.stdout._handle.setBlocking(true); // nodejs/node#6456\n\n    }\n\n    console.log(help(settings.help));\n\n    if (!config.required) {\n      process.exit(0);\n    }\n  }\n\n  if (settings.version) {\n    version().then(function (v) {\n      console.log(v);\n\n      if (!config.required) {\n        process.exit(0);\n      }\n    });\n    return;\n  } // nodemon tools like grunt-nodemon. This affects where\n  // the script is being run from, and will affect where\n  // nodemon looks for the nodemon.json files\n\n\n  if (settings.cwd) {\n    // this is protection to make sure we haven't dont the chdir already...\n    // say like in cli/parse.js (which is where we do this once already!)\n    if (process.cwd() !== path.resolve(config.system.cwd, settings.cwd)) {\n      process.chdir(settings.cwd);\n    }\n  }\n\n  const cwd = process.cwd();\n  config.load(settings, function (config) {\n    if (!config.options.dump && !config.options.execOptions.script && config.options.execOptions.exec === 'node') {\n      if (!config.required) {\n        console.log(help('usage'));\n        process.exit();\n      }\n\n      return;\n    } // before we print anything, update the colour setting on logging\n\n\n    utils.colours = config.options.colours; // always echo out the current version\n\n    utils.log.info(version.pinned);\n    const cwd = process.cwd();\n\n    if (config.options.cwd) {\n      utils.log.detail('process root: ' + cwd);\n    }\n\n    config.loaded.map(file => file.replace(cwd, '.')).forEach(file => {\n      utils.log.detail('reading config ' + file);\n    });\n\n    if (config.options.stdin && config.options.restartable) {\n      // allow nodemon to restart when the use types 'rs\\n'\n      process.stdin.resume();\n      process.stdin.setEncoding('utf8');\n      process.stdin.on('data', data => {\n        const str = data.toString().trim().toLowerCase(); // if the keys entered match the restartable value, then restart!\n\n        if (str === config.options.restartable) {\n          bus.emit('restart');\n        } else if (data.charCodeAt(0) === 12) {\n          // ctrl+l\n          console.clear();\n        }\n      });\n    } else if (config.options.stdin) {\n      // so let's make sure we don't eat the key presses\n      // but also, since we're wrapping, watch out for\n      // special keys, like ctrl+c x 2 or '.exit' or ctrl+d or ctrl+l\n      var ctrlC = false;\n      var buffer = '';\n      process.stdin.on('data', function (data) {\n        data = data.toString();\n        buffer += data;\n        const chr = data.charCodeAt(0); // if restartable, echo back\n\n        if (chr === 3) {\n          if (ctrlC) {\n            process.exit(0);\n          }\n\n          ctrlC = true;\n          return;\n        } else if (buffer === '.exit' || chr === 4) {\n          // ctrl+d\n          process.exit();\n        } else if (chr === 13 || chr === 10) {\n          // enter / carriage return\n          buffer = '';\n        } else if (chr === 12) {\n          // ctrl+l\n          console.clear();\n          buffer = '';\n        }\n\n        ctrlC = false;\n      });\n\n      if (process.stdin.setRawMode) {\n        process.stdin.setRawMode(true);\n      }\n    }\n\n    if (config.options.restartable) {\n      utils.log.info('to restart at any time, enter `' + config.options.restartable + '`');\n    }\n\n    if (!config.required) {\n      const restartSignal = config.options.signal === 'SIGUSR2' ? 'SIGHUP' : 'SIGUSR2';\n      process.on(restartSignal, nodemon.restart);\n      utils.bus.on('error', () => {\n        utils.log.fail(new Error().stack);\n      });\n      utils.log.detail((config.options.restartable ? 'or ' : '') + 'send ' + restartSignal + ' to ' + process.pid + ' to restart');\n    }\n\n    const ignoring = config.options.monitor.map(function (rule) {\n      if (rule.slice(0, 1) !== '!') {\n        return false;\n      }\n\n      rule = rule.slice(1); // don't notify of default ignores\n\n      if (defaults.ignoreRoot.indexOf(rule) !== -1) {\n        return false;\n        return rule.slice(3).slice(0, -3);\n      }\n\n      if (rule.startsWith(cwd)) {\n        return rule.replace(cwd, '.');\n      }\n\n      return rule;\n    }).filter(Boolean).join(' ');\n    if (ignoring) utils.log.detail('ignoring: ' + ignoring);\n    utils.log.info('watching path(s): ' + config.options.monitor.map(function (rule) {\n      if (rule.slice(0, 1) !== '!') {\n        try {\n          rule = path.relative(process.cwd(), rule);\n        } catch (e) {}\n\n        return rule;\n      }\n\n      return false;\n    }).filter(Boolean).join(' '));\n    utils.log.info('watching extensions: ' + (config.options.execOptions.ext || '(all)'));\n\n    if (config.options.dump) {\n      utils.log._log('log', '--------------');\n\n      utils.log._log('log', 'node: ' + process.version);\n\n      utils.log._log('log', 'nodemon: ' + version.pinned);\n\n      utils.log._log('log', 'command: ' + process.argv.join(' '));\n\n      utils.log._log('log', 'cwd: ' + cwd);\n\n      utils.log._log('log', ['OS:', process.platform, process.arch].join(' '));\n\n      utils.log._log('log', '--------------');\n\n      utils.log._log('log', util.inspect(config, {\n        depth: null\n      }));\n\n      utils.log._log('log', '--------------');\n\n      if (!config.required) {\n        process.exit();\n      }\n\n      return;\n    }\n\n    config.run = true;\n\n    if (config.options.stdout === false) {\n      nodemon.on('start', function () {\n        nodemon.stdout = bus.stdout;\n        nodemon.stderr = bus.stderr;\n        bus.emit('readable');\n      });\n    }\n\n    if (config.options.events && Object.keys(config.options.events).length) {\n      Object.keys(config.options.events).forEach(function (key) {\n        utils.log.detail('bind ' + key + ' -> `' + config.options.events[key] + '`');\n        nodemon.on(key, function () {\n          if (config.options && config.options.events) {\n            spawn(config.options.events[key], config, [].slice.apply(arguments));\n          }\n        });\n      });\n    }\n\n    monitor.run(config.options);\n  });\n  return nodemon;\n}\n\nnodemon.restart = function () {\n  utils.log.status('restarting child process');\n  bus.emit('restart');\n  return nodemon;\n};\n\nnodemon.addListener = nodemon.on = function (event, handler) {\n  if (!eventHandlers[event]) {\n    eventHandlers[event] = [];\n  }\n\n  eventHandlers[event].push(handler);\n  bus.on(event, handler);\n  return nodemon;\n};\n\nnodemon.once = function (event, handler) {\n  if (!eventHandlers[event]) {\n    eventHandlers[event] = [];\n  }\n\n  eventHandlers[event].push(handler);\n  bus.once(event, function () {\n    debug('bus.once(%s)', event);\n    eventHandlers[event].splice(eventHandlers[event].indexOf(handler), 1);\n    handler.apply(this, arguments);\n  });\n  return nodemon;\n};\n\nnodemon.emit = function () {\n  bus.emit.apply(bus, [].slice.call(arguments));\n  return nodemon;\n};\n\nnodemon.removeAllListeners = function (event) {\n  // unbind only the `nodemon.on` event handlers\n  Object.keys(eventHandlers).filter(function (e) {\n    return event ? e === event : true;\n  }).forEach(function (event) {\n    eventHandlers[event].forEach(function (handler) {\n      bus.removeListener(event, handler);\n      eventHandlers[event].splice(eventHandlers[event].indexOf(handler), 1);\n    });\n  });\n  return nodemon;\n};\n\nnodemon.reset = function (done) {\n  bus.emit('reset', done);\n};\n\nbus.on('reset', function (done) {\n  debug('reset');\n  nodemon.removeAllListeners();\n  monitor.run.kill(true, function () {\n    utils.reset();\n    config.reset();\n    config.run = false;\n\n    if (done) {\n      done();\n    }\n  });\n}); // expose the full config\n\nnodemon.config = config;\nmodule.exports = nodemon;","map":{"version":3,"sources":["/Users/jordanthomson/code/blog-with-Node-React/node_modules/nodemon/lib/nodemon.js"],"names":["debug","require","path","monitor","cli","version","util","utils","bus","help","config","spawn","defaults","eventHandlers","required","isRequired","nodemon","settings","emit","reset","trim","indexOf","parse","verbose","process","stdout","isTTY","_handle","setBlocking","console","log","exit","then","v","cwd","resolve","system","chdir","load","options","dump","execOptions","script","exec","colours","info","pinned","detail","loaded","map","file","replace","forEach","stdin","restartable","resume","setEncoding","on","data","str","toString","toLowerCase","charCodeAt","clear","ctrlC","buffer","chr","setRawMode","restartSignal","signal","restart","fail","Error","stack","pid","ignoring","rule","slice","ignoreRoot","startsWith","filter","Boolean","join","relative","e","ext","_log","argv","platform","arch","inspect","depth","run","stderr","events","Object","keys","length","key","apply","arguments","status","addListener","event","handler","push","once","splice","call","removeAllListeners","removeListener","done","kill","module","exports"],"mappings":"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","sourcesContent":["var debug = require('debug')('nodemon');\nvar path = require('path');\nvar monitor = require('./monitor');\nvar cli = require('./cli');\nvar version = require('./version');\nvar util = require('util');\nvar utils = require('./utils');\nvar bus = utils.bus;\nvar help = require('./help');\nvar config = require('./config');\nvar spawn = require('./spawn');\nconst defaults = require('./config/defaults')\nvar eventHandlers = {};\n\n// this is fairly dirty, but theoretically sound since it's part of the\n// stable module API\nconfig.required = utils.isRequired;\n\nfunction nodemon(settings) {\n  bus.emit('boot');\n  nodemon.reset();\n\n  // allow the cli string as the argument to nodemon, and allow for\n  // `node nodemon -V app.js` or just `-V app.js`\n  if (typeof settings === 'string') {\n    settings = settings.trim();\n    if (settings.indexOf('node') !== 0) {\n      if (settings.indexOf('nodemon') !== 0) {\n        settings = 'nodemon ' + settings;\n      }\n      settings = 'node ' + settings;\n    }\n    settings = cli.parse(settings);\n  }\n\n  // set the debug flag as early as possible to get all the detailed logging\n  if (settings.verbose) {\n    utils.debug = true;\n  }\n\n  if (settings.help) {\n    if (process.stdout.isTTY) {\n      process.stdout._handle.setBlocking(true); // nodejs/node#6456\n    }\n    console.log(help(settings.help));\n    if (!config.required) {\n      process.exit(0);\n    }\n  }\n\n  if (settings.version) {\n    version().then(function (v) {\n      console.log(v);\n      if (!config.required) {\n        process.exit(0);\n      }\n    });\n    return;\n  }\n\n  // nodemon tools like grunt-nodemon. This affects where\n  // the script is being run from, and will affect where\n  // nodemon looks for the nodemon.json files\n  if (settings.cwd) {\n    // this is protection to make sure we haven't dont the chdir already...\n    // say like in cli/parse.js (which is where we do this once already!)\n    if (process.cwd() !== path.resolve(config.system.cwd, settings.cwd)) {\n      process.chdir(settings.cwd);\n    }\n  }\n\n  const cwd = process.cwd();\n\n  config.load(settings, function (config) {\n    if (!config.options.dump && !config.options.execOptions.script &&\n      config.options.execOptions.exec === 'node') {\n      if (!config.required) {\n        console.log(help('usage'));\n        process.exit();\n      }\n      return;\n    }\n\n    // before we print anything, update the colour setting on logging\n    utils.colours = config.options.colours;\n\n    // always echo out the current version\n    utils.log.info(version.pinned);\n\n    const cwd = process.cwd();\n\n    if (config.options.cwd) {\n      utils.log.detail('process root: ' + cwd);\n    }\n\n    config.loaded.map(file => file.replace(cwd, '.')).forEach(file => {\n      utils.log.detail('reading config ' + file);\n    });\n\n    if (config.options.stdin && config.options.restartable) {\n      // allow nodemon to restart when the use types 'rs\\n'\n      process.stdin.resume();\n      process.stdin.setEncoding('utf8');\n      process.stdin.on('data', data => {\n        const str = data.toString().trim().toLowerCase();\n\n        // if the keys entered match the restartable value, then restart!\n        if (str === config.options.restartable) {\n          bus.emit('restart');\n        } else if (data.charCodeAt(0) === 12) { // ctrl+l\n          console.clear();\n        }\n      });\n    } else if (config.options.stdin) {\n      // so let's make sure we don't eat the key presses\n      // but also, since we're wrapping, watch out for\n      // special keys, like ctrl+c x 2 or '.exit' or ctrl+d or ctrl+l\n      var ctrlC = false;\n      var buffer = '';\n\n      process.stdin.on('data', function (data) {\n        data = data.toString();\n        buffer += data;\n        const chr = data.charCodeAt(0);\n\n        // if restartable, echo back\n        if (chr === 3) {\n          if (ctrlC) {\n            process.exit(0);\n          }\n\n          ctrlC = true;\n          return;\n        } else if (buffer === '.exit' || chr === 4) { // ctrl+d\n          process.exit();\n        } else if (chr === 13 || chr === 10) { // enter / carriage return\n          buffer = '';\n        } else if (chr === 12) { // ctrl+l\n          console.clear();\n          buffer = '';\n        }\n        ctrlC = false;\n      });\n      if (process.stdin.setRawMode) {\n        process.stdin.setRawMode(true);\n      }\n    }\n\n    if (config.options.restartable) {\n      utils.log.info('to restart at any time, enter `' +\n        config.options.restartable + '`');\n    }\n\n    if (!config.required) {\n      const restartSignal = config.options.signal === 'SIGUSR2' ? 'SIGHUP' : 'SIGUSR2';\n      process.on(restartSignal, nodemon.restart);\n      utils.bus.on('error', () => {\n        utils.log.fail((new Error().stack));\n      });\n      utils.log.detail((config.options.restartable ? 'or ' : '') + 'send ' +\n        restartSignal + ' to ' + process.pid + ' to restart');\n    }\n\n    const ignoring = config.options.monitor.map(function (rule) {\n      if (rule.slice(0, 1) !== '!') {\n        return false;\n      }\n\n      rule = rule.slice(1);\n\n      // don't notify of default ignores\n      if (defaults.ignoreRoot.indexOf(rule) !== -1) {\n        return false;\n        return rule.slice(3).slice(0, -3);\n      }\n\n      if (rule.startsWith(cwd)) {\n        return rule.replace(cwd, '.');\n      }\n\n      return rule;\n    }).filter(Boolean).join(' ');\n    if (ignoring) utils.log.detail('ignoring: ' + ignoring);\n\n    utils.log.info('watching path(s): ' + config.options.monitor.map(function (rule) {\n      if (rule.slice(0, 1) !== '!') {\n        try {\n          rule = path.relative(process.cwd(), rule);\n        } catch (e) {}\n\n        return rule;\n      }\n\n      return false;\n    }).filter(Boolean).join(' '));\n\n    utils.log.info('watching extensions: ' + (config.options.execOptions.ext || '(all)'));\n\n    if (config.options.dump) {\n      utils.log._log('log', '--------------');\n      utils.log._log('log', 'node: ' + process.version);\n      utils.log._log('log', 'nodemon: ' + version.pinned);\n      utils.log._log('log', 'command: ' + process.argv.join(' '));\n      utils.log._log('log', 'cwd: ' + cwd);\n      utils.log._log('log', ['OS:', process.platform, process.arch].join(' '));\n      utils.log._log('log', '--------------');\n      utils.log._log('log', util.inspect(config, { depth: null }));\n      utils.log._log('log', '--------------');\n      if (!config.required) {\n        process.exit();\n      }\n\n      return;\n    }\n\n    config.run = true;\n\n    if (config.options.stdout === false) {\n      nodemon.on('start', function () {\n        nodemon.stdout = bus.stdout;\n        nodemon.stderr = bus.stderr;\n\n        bus.emit('readable');\n      });\n    }\n\n    if (config.options.events && Object.keys(config.options.events).length) {\n      Object.keys(config.options.events).forEach(function (key) {\n        utils.log.detail('bind ' + key + ' -> `' +\n          config.options.events[key] + '`');\n        nodemon.on(key, function () {\n          if (config.options && config.options.events) {\n            spawn(config.options.events[key], config,\n              [].slice.apply(arguments));\n          }\n        });\n      });\n    }\n\n    monitor.run(config.options);\n\n  });\n\n  return nodemon;\n}\n\nnodemon.restart = function () {\n  utils.log.status('restarting child process');\n  bus.emit('restart');\n  return nodemon;\n};\n\nnodemon.addListener = nodemon.on = function (event, handler) {\n  if (!eventHandlers[event]) { eventHandlers[event] = []; }\n  eventHandlers[event].push(handler);\n  bus.on(event, handler);\n  return nodemon;\n};\n\nnodemon.once = function (event, handler) {\n  if (!eventHandlers[event]) { eventHandlers[event] = []; }\n  eventHandlers[event].push(handler);\n  bus.once(event, function () {\n    debug('bus.once(%s)', event);\n    eventHandlers[event].splice(eventHandlers[event].indexOf(handler), 1);\n    handler.apply(this, arguments);\n  });\n  return nodemon;\n};\n\nnodemon.emit = function () {\n  bus.emit.apply(bus, [].slice.call(arguments));\n  return nodemon;\n};\n\nnodemon.removeAllListeners = function (event) {\n  // unbind only the `nodemon.on` event handlers\n  Object.keys(eventHandlers).filter(function (e) {\n    return event ? e === event : true;\n  }).forEach(function (event) {\n    eventHandlers[event].forEach(function (handler) {\n      bus.removeListener(event, handler);\n      eventHandlers[event].splice(eventHandlers[event].indexOf(handler), 1);\n    });\n  });\n\n  return nodemon;\n};\n\nnodemon.reset = function (done) {\n  bus.emit('reset', done);\n};\n\nbus.on('reset', function (done) {\n  debug('reset');\n  nodemon.removeAllListeners();\n  monitor.run.kill(true, function () {\n    utils.reset();\n    config.reset();\n    config.run = false;\n    if (done) {\n      done();\n    }\n  });\n});\n\n// expose the full config\nnodemon.config = config;\n\nmodule.exports = nodemon;\n\n"]},"metadata":{},"sourceType":"script"}